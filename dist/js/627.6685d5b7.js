"use strict";(self["webpackChunkrolling"]=self["webpackChunkrolling"]||[]).push([[627],{9334:function(e,t,o){var n=o(6154),i=o(9876),a=o(6294);const l=(0,a.Z)();t.Z=(0,i.Q_)("articleStore",{state:()=>({articles:[],article:{},pagination:{}}),actions:{async getArticles(e=1){this.scrollToTop(),l.isLoadingForStore=!0;const t=`https://vue3-course-api.hexschool.io/api/je-api/articles/?page=${e}`;try{const e=await n.Z.get(t);l.isLoadingForStore=!1,this.articles=e.data.articles,this.pagination=e.data.pagination}catch(o){console.error("Error 找不到資料",o)}},async getArticle(e){this.scrollToTop();const t=`https://vue3-course-api.hexschool.io/api/je-api/article/${e}`;l.isLoadingForStore=!0;try{l.isLoadingForStore=!1;const e=await n.Z.get(t);this.article=e.data.article}catch(o){console.error("Error 找不到資料",o)}},scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}}})},6294:function(e,t,o){var n=o(9876);t.Z=(0,n.Q_)("statusStore",{state:()=>({isLoadingForStore:!1,cartLoadingItem:""})})},6627:function(e,t,o){o.r(t),o.d(t,{default:function(){return nt}});var n=o(6252),i=o(3577);const a={class:"container-fluid"},l={class:"row"},r={class:"col-12 border-bottom border-black"},s={class:"container-fluid d-flex justify-content-between align-items-center p-4"},c=(0,n._)("h1",{class:"page-title"},"Articles",-1),d=(0,n._)("i",{class:"bi bi-plus-lg"},null,-1),u={key:1,class:"col-12"},p={class:"card mb-4 bg-gray-white"},m={class:"card-body pt-lg-4 mt-lg-3 py-0 px-lg-5"},b={class:"table-responsive p-0 d-flex"},f={class:"table lh-lg mb-0 table-hover"},g=(0,n._)("thead",null,[(0,n._)("tr",null,[(0,n._)("th",{class:"text-secondary text-xxs fw-normal pb-lg-4 pt-sm-0"},"標題"),(0,n._)("th",{class:"text-secondary text-xxs fw-normal pb-lg-4 pt-sm-0"},"建立時間"),(0,n._)("th",{class:"text-secondary text-xxs fw-normal pb-lg-4 pt-sm-0"},"作者"),(0,n._)("th",{class:"text-secondary text-xxs fw-normal pb-lg-4 pt-sm-0 text-center"}," 啟用 ")])],-1),h=["onClick"],y={class:"text-center"},v={key:0},_=(0,n._)("i",{class:"bi bi-check-lg fs-5"},null,-1),x=[_],w={key:1};function k(e,t,o,_,k,A){const S=(0,n.up)("DashboardSkeleton"),M=(0,n.up)("Pagination"),C=(0,n.up)("ArticleModal"),D=(0,n.up)("Loading"),L=(0,n.up)("DelModal");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",a,[(0,n._)("div",l,[(0,n._)("div",r,[(0,n._)("div",s,[c,(0,n._)("button",{class:"btn btn-outline-dark border-1 rounded-0 me-lg-3 mb-0 px-lg-5 py-lg-2",onClick:t[0]||(t[0]=e=>A.openModal(!0))},[d,(0,n.Uk)(" 新增文章 ")])])]),e.isLoadingForStore?((0,n.wg)(),(0,n.j4)(S,{key:0})):(0,n.kq)("",!0),e.isLoadingForStore?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",u,[(0,n._)("div",p,[(0,n._)("div",m,[(0,n._)("div",b,[(0,n._)("table",f,[g,(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.articles,(t=>((0,n.wg)(),(0,n.iD)("tr",{class:"cursor-pointer",onClick:e=>A.openModal(!1,t),key:t.id},[(0,n._)("td",null,(0,i.zw)(t.title),1),(0,n._)("td",null,(0,i.zw)(e.$filters.date(t.create_at)),1),(0,n._)("td",null,(0,i.zw)(t.author),1),(0,n._)("td",y,[!0===t.isPublic?((0,n.wg)(),(0,n.iD)("span",v,x)):((0,n.wg)(),(0,n.iD)("span",w))])],8,h)))),128))])])])]),(0,n.Wm)(M,{pages:e.pagination,onEmitPages:e.getArticles},null,8,["pages","onEmitPages"])])]))])]),(0,n.Wm)(C,{ref:"articleModal",article:k.tempArticle,onDelArticle:t[1]||(t[1]=e=>A.openDelModal(k.tempArticle)),onUpdateArticle:A.updateArticle,isNew:k.isNew},null,8,["article","onUpdateArticle","isNew"]),(0,n.Wm)(D,{active:k.isLoading,zIndex:1e4},null,8,["active"]),(0,n.Wm)(L,{item:k.tempArticle,onDelItem:A.delArticle,ref:"delModal"},null,8,["item","onDelItem"])],64)}var A=o(6154),S=o(9963);const M={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true","data-bs-focus":"false",ref:"modal"},C={class:"modal-dialog modal-xl modal-dialog-centered modal-fullscreen-md-down"},D={class:"modal-content bg-gray-white rounded-0 p-0 border-0"},L=(0,n._)("div",{class:"modal-header border-bottom border-black p-4"},[(0,n._)("h1",{class:"modal-title fs-5 font-family-taipei fw-normal",id:"exampleModalLabel"},"新增/編輯文章"),(0,n._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),j={class:"modal-body p-0"},E={class:"container-fluid"},P={class:"row p-0"},U={class:"col-12"},F={class:"card border-lg border-bottom border-black px-2 py-4"},V={class:"card-header pb-2 mb-0 d-flex justify-content-between align-items-center"},Z=(0,n._)("h6",{class:"mb-0 fs-5 font-family-taipei"},[(0,n.Uk)("文章內容編輯 "),(0,n._)("small",{class:"text-danger font-family-taipei text-xxs"},"(必填)")],-1),$=(0,n._)("ins",null,"前往觀看文章",-1),I=[$],O={class:"card-body w-100"},N={class:"row"},B={class:"col-lg-6 col-sm-12"},z={class:"card border-lg border-bottom border-black px-2 py-4"},T=(0,n._)("div",{class:"card-header pb-2 mb-0"},[(0,n._)("h6",{class:"mb-0 fs-5 font-family-taipei"},"文章圖片")],-1),K={class:"card-body px-sm-4 d-flex justify-content-center align-items-center"},R={class:"cursor-pointer preview",for:"customFile"},Y={key:0,class:"w-100 h-100 border border-black p-3 d-flex justify-content-center align-items-center position-relative"},W=["src"],q=(0,n._)("div",{class:"position-absolute bg-opacity-50 bg-black p-2 w-100 bottom-0 start-0 text-center text-white"},"編輯",-1),G={key:1,class:"w-100 h-100 border border-black d-flex justify-content-center align-items-center"},H=(0,n._)("p",{class:"m-0 p-0"},"請選擇圖片",-1),Q=[H],J={class:"card border-lg px-2 py-4"},X=(0,n._)("div",{class:"card-header pb-2 mb-0"},[(0,n._)("h6",{class:"mb-0 fs-5 font-family-taipei"},"是否公開")],-1),ee={class:"card-body"},te={class:"d-flex justify-content-between align-items-center px-5 pt-5"},oe=(0,n._)("label",{for:"true",class:"true px-lg-5 py-lg-2 px-4 py-1 cursor-pointer border-2 rounded-5 fs-5"},[(0,n._)("span",null,"是")],-1),ne=(0,n._)("label",{for:"false",class:"false px-lg-5 py-lg-2 px-4 py-1 cursor-pointer border-2 rounded-5 fs-5"},[(0,n._)("span",null,"否")],-1),ie={class:"col-lg-6 col-sm-12"},ae={class:"card border-lg border-start border-black px-2 py-4"},le=(0,n._)("div",{class:"card-header pb-2 mb-0"},[(0,n._)("h6",{class:"mb-0 fs-5 font-family-taipei"},[(0,n.Uk)("文章資訊 "),(0,n._)("small",{class:"text-danger font-family-taipei text-xxs"},"(必填)")])],-1),re={class:"card-body"},se={class:"mb-4"},ce=(0,n._)("p",{class:"mb-2 text-black"},"標題",-1),de={class:"mb-4"},ue=(0,n._)("p",{class:"mb-2 text-black"},"描述",-1),pe={class:"mb-4"},me=(0,n._)("p",{class:"mb-2 text-black"},"作者",-1),be={class:"mb-4"},fe=(0,n._)("p",{class:"mb-2 text-black"},"標籤",-1),ge={class:"mb-4"},he=(0,n._)("p",{class:"mb-2 text-black"},"創建時間",-1),ye={class:"modal-footer d-flex justify-content-between p-lg-5 border-top border-black p-3 bg-sm-color"},ve=(0,n._)("p",null,null,-1);function _e(e,t,o,i,a,l){const r=(0,n.up)("Editor"),s=(0,n.up)("Loading");return(0,n.wg)(),(0,n.iD)("div",M,[(0,n._)("div",C,[(0,n._)("div",D,[L,(0,n._)("div",j,[(0,n._)("div",E,[(0,n._)("div",P,[(0,n._)("div",U,[(0,n._)("div",F,[(0,n._)("div",V,[Z,(0,n._)("a",{href:"",class:"pe-2",onClick:t[0]||(t[0]=(0,S.iM)((e=>l.getArticle(o.article.id)),["prevent"]))},I)]),(0,n._)("div",O,[(0,n.Wm)(r,{"api-key":"v9qd6mo7pj1ij6ci3z7691b9kd3fjj2bc9km9xgru539dsyt",init:{menubar:"insert",plugins:["table","link","autolink"],auto_focus:!0,anchor_top:!1,anchor_bottom:!1,table_default_attributes:{border:"0"},relative_urls:!0,toolbar_mode:"wrap",toolbar:"undo redo | blocks formatselect fontsize |                         bold italic backcolor underline |                         alignleft aligncenter alignright alignjustify |                         fontsizeselect bullist numlist outdent indent |                         removeformat | table tabledelete | link "},modelValue:a.tempArticle.content,"onUpdate:modelValue":t[1]||(t[1]=e=>a.tempArticle.content=e)},null,8,["modelValue"])])])])]),(0,n._)("div",N,[(0,n._)("div",B,[(0,n._)("div",z,[T,(0,n._)("div",K,[(0,n._)("label",R,[(0,n._)("input",{class:"d-none",type:"file",id:"customFile",onChange:t[2]||(t[2]=(...e)=>l.uploadFile&&l.uploadFile(...e)),ref:"fileInput"},null,544),void 0!==a.tempArticle.image?((0,n.wg)(),(0,n.iD)("div",Y,[(0,n._)("img",{class:"w-100",src:a.tempArticle.image,alt:""},null,8,W),q])):((0,n.wg)(),(0,n.iD)("div",G,Q))])])]),(0,n._)("div",J,[X,(0,n._)("div",ee,[(0,n._)("div",te,[(0,n.wy)((0,n._)("input",{class:"d-none input-true",type:"radio",name:"select",id:"true",checked:"",value:!0,"onUpdate:modelValue":t[3]||(t[3]=e=>a.tempArticle.isPublic=e)},null,512),[[S.G2,a.tempArticle.isPublic]]),oe,(0,n.wy)((0,n._)("input",{class:"d-none input-false",type:"radio",name:"select",id:"false",value:!1,"onUpdate:modelValue":t[4]||(t[4]=e=>a.tempArticle.isPublic=e)},null,512),[[S.G2,a.tempArticle.isPublic]]),ne])])])]),(0,n._)("div",ie,[(0,n._)("div",ae,[le,(0,n._)("div",re,[(0,n._)("div",se,[ce,(0,n.wy)((0,n._)("input",{class:"form-control border-dark rounded-0 border-1 bg-transparent p-3",type:"text",placeholder:"請輸入標題","aria-label":"example","onUpdate:modelValue":t[5]||(t[5]=e=>a.tempArticle.title=e)},null,512),[[S.nr,a.tempArticle.title]])]),(0,n._)("div",de,[ue,(0,n.wy)((0,n._)("input",{class:"form-control border-dark rounded-0 border-1 bg-transparent p-3",type:"text",placeholder:"請輸入描述","aria-label":"example","onUpdate:modelValue":t[6]||(t[6]=e=>a.tempArticle.description=e)},null,512),[[S.nr,a.tempArticle.description]])]),(0,n._)("div",pe,[me,(0,n.wy)((0,n._)("input",{class:"form-control border-dark rounded-0 border-1 bg-transparent p-3",type:"text",placeholder:"請輸入作者","aria-label":"example","onUpdate:modelValue":t[7]||(t[7]=e=>a.tempArticle.author=e)},null,512),[[S.nr,a.tempArticle.author]])]),(0,n._)("div",be,[fe,(0,n.wy)((0,n._)("input",{class:"form-control border-dark rounded-0 border-1 bg-transparent p-3",type:"text",placeholder:"請輸入標籤","aria-label":"example","onUpdate:modelValue":t[8]||(t[8]=e=>a.tempArticle.tag=e)},null,512),[[S.nr,a.tempArticle.tag]])]),(0,n._)("div",ge,[he,(0,n.wy)((0,n._)("input",{class:"form-control border-dark rounded-0 border-1 bg-transparent p-3",type:"date","aria-label":"example","onUpdate:modelValue":t[9]||(t[9]=e=>a.create_at=e)},null,512),[[S.nr,a.create_at]])])])])])])])]),(0,n._)("div",ye,[!1===o.isNew?((0,n.wg)(),(0,n.iD)("button",{key:0,type:"button",class:"btn btn-outline-dark rounded-5 me-3 mb-0 px-lg-5 py-lg-3 px-4 py-2",onClick:t[10]||(t[10]=t=>e.$emit("del-article",a.tempArticle))},"刪除")):(0,n.kq)("",!0),ve,(0,n._)("button",{type:"button",class:"btn btn-dark rounded-5 me-3 mb-0 px-lg-5 py-lg-3 px-4 py-2",onClick:t[11]||(t[11]=t=>e.$emit("update-article",a.tempArticle))},"確認")])])]),(0,n.Wm)(s,{active:a.isLoading},null,8,["active"])],512)}var xe=o(1339),we=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],ke=function(e){return-1!==we.map((function(e){return e.toLowerCase()})).indexOf(e.toLowerCase())},Ae=function(e,t,o){Object.keys(t).filter(ke).forEach((function(n){var i=t[n];"function"===typeof i&&("onInit"===n?i(e,o):o.on(n.substring(2),(function(e){return i(e,o)})))}))},Se=function(e,t,o,i){var a=e.modelEvents?e.modelEvents:null,l=Array.isArray(a)?a.join(" "):a;(0,n.YP)(i,(function(t,n){o&&"string"===typeof t&&t!==n&&t!==o.getContent({format:e.outputFormat})&&o.setContent(t)})),o.on(l||"change input undo redo",(function(){t.emit("update:modelValue",o.getContent({format:e.outputFormat}))}))},Me=function(e,t,o,n,i,a){n.setContent(a()),o.attrs["onUpdate:modelValue"]&&Se(t,o,n,i),Ae(e,o.attrs,n)},Ce=0,De=function(e){var t=Date.now(),o=Math.floor(1e9*Math.random());return Ce++,e+"_"+o+Ce+String(t)},Le=function(e){return null!==e&&"textarea"===e.tagName.toLowerCase()},je=function(e){return"undefined"===typeof e||""===e?[]:Array.isArray(e)?e:e.split(" ")},Ee=function(e,t){return je(e).concat(je(t))},Pe=function(e){return null===e||void 0===e},Ue=function(){return{listeners:[],scriptId:De("tiny-script"),scriptLoaded:!1}},Fe=function(){var e=Ue(),t=function(e,t,o,n){var i=t.createElement("script");i.referrerPolicy="origin",i.type="application/javascript",i.id=e,i.src=o;var a=function(){i.removeEventListener("load",a),n()};i.addEventListener("load",a),t.head&&t.head.appendChild(i)},o=function(o,n,i){e.scriptLoaded?i():(e.listeners.push(i),o.getElementById(e.scriptId)||t(e.scriptId,o,n,(function(){e.listeners.forEach((function(e){return e()})),e.scriptLoaded=!0})))},n=function(){e=Ue()};return{load:o,reinitialize:n}},Ve=Fe(),Ze=function(){return"undefined"!==typeof window?window:o.g},$e=function(){var e=Ze();return e&&e.tinymce?e.tinymce:null},Ie={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return"html"===e||"text"===e}}},Oe=o(2262),Ne=function(){return Ne=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var i in t=arguments[o],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},Ne.apply(this,arguments)},Be=function(e,t,o,n){return e(n||"div",{id:t,ref:o})},ze=function(e,t,o){return e("textarea",{id:t,visibility:"hidden",ref:o})},Te=(0,n.aZ)({props:Ie,setup:function(e,t){var o=e.init?Ne({},e.init):{},i=(0,Oe.BK)(e),a=i.disabled,l=i.modelValue,r=i.tagName,s=(0,Oe.iH)(null),c=null,d=e.id||De("tiny-vue"),u=e.init&&e.init.inline||e.inline,p=!!t.attrs["onUpdate:modelValue"],m=!0,b=e.initialValue?e.initialValue:"",f="",g=function(e){return p?function(){return(null===l||void 0===l?void 0:l.value)?l.value:""}:function(){return e?b:f}},h=function(){var n=g(m),i=Ne(Ne({},o),{readonly:e.disabled,target:s.value,plugins:Ee(o.plugins,e.plugins),toolbar:e.toolbar||o.toolbar,inline:u,setup:function(i){c=i,i.on("init",(function(o){return Me(o,e,t,i,l,n)})),"function"===typeof o.setup&&o.setup(i)}});Le(s.value)&&(s.value.style.visibility=""),$e().init(i),m=!1};(0,n.YP)(a,(function(e){var t;null!==c&&("function"===typeof(null===(t=c.mode)||void 0===t?void 0:t.set)?c.mode.set(e?"readonly":"design"):c.setMode(e?"readonly":"design"))})),(0,n.YP)(r,(function(e){var t;p||(f=c.getContent()),null===(t=$e())||void 0===t||t.remove(c),(0,n.Y3)((function(){return h()}))})),(0,n.bv)((function(){if(null!==$e())h();else if(s.value&&s.value.ownerDocument){var t=e.cloudChannel?e.cloudChannel:"6",o=e.apiKey?e.apiKey:"no-api-key",n=Pe(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/".concat(o,"/tinymce/").concat(t,"/tinymce.min.js"):e.tinymceScriptSrc;Ve.load(s.value.ownerDocument,n,h)}})),(0,n.Jd)((function(){null!==$e()&&$e().remove(c)})),u||((0,n.dl)((function(){m||h()})),(0,n.se)((function(){var e;p||(f=c.getContent()),null===(e=$e())||void 0===e||e.remove(c)})));var y=function(e){var t;f=c.getContent(),null===(t=$e())||void 0===t||t.remove(c),o=Ne(Ne({},o),e),(0,n.Y3)((function(){return h()}))};return t.expose({rerender:y,getEditor:function(){return c}}),function(){return u?Be(n.h,d,s,e.tagName):ze(n.h,d,s)}}}),Ke=Te,Re={components:{Editor:Ke},props:{article:{type:Object,default(){return{}}},isNew:{type:Boolean,required:!0}},data(){return{isLoading:!1,modal:{},tempArticle:{},create_at:""}},methods:{async uploadFile(){try{this.isLoading=!0;const e=this.$refs.fileInput.files[0],t=new FormData;t.append("file-to-upload",e);const o="https://vue3-course-api.hexschool.io/api/je-api/admin/upload",n=await A.Z.post(o,t);n.data.success&&(this.tempArticle.image=n.data.imageUrl,this.isLoading=!1)}catch(e){console.error("Error",e)}this.isLoading=!1},getArticle(e){const t=this.$router.resolve({path:`/article/${e}`});window.open(t.href,"_blank")}},watch:{article(){this.tempArticle=this.article;const e=new Date(1e3*this.tempArticle.create_at).toISOString().split("T");[this.create_at]=e},create_at(){this.tempArticle.create_at=Math.floor(new Date(this.create_at)/1e3)}},emits:["update-article","del-article"],mixins:[xe.Z]},Ye=o(3744);const We=(0,Ye.Z)(Re,[["render",_e]]);var qe=We,Ge=o(7130),He=o(6463),Qe=o(9876),Je=o(9334),Xe=o(6294),et=o(552),tt={components:{ArticleModal:qe,Pagination:Ge.Z,DelModal:He.Z,DashboardSkeleton:et.Z},data(){return{tempArticle:{},isNew:!1,isLoading:!1,skeletonNum:15}},computed:{...(0,Qe.rn)(Je.Z,["articles","pagination"]),...(0,Qe.rn)(Xe.Z,["isLoadingForStore"])},methods:{...(0,Qe.nv)(Je.Z,["getArticles"]),async openModal(e,t){if(this.isLoading=!0,e)this.tempArticle={create_at:(new Date).getTime()/1e3,isPublic:!0,content:""};else{const e=`https://vue3-course-api.hexschool.io/api/je-api/admin/article/${t.id}`;try{const t=await A.Z.get(e);this.tempArticle=t.data.article}catch(o){console.error("Error 找不到資料",o)}}this.isNew=e,this.isLoading=!1,this.$refs.articleModal.showModal()},async updateArticle(e){try{this.tempArticle=e;let t="https://vue3-course-api.hexschool.io/api/je-api/admin/article",o="post";this.isLoading=!0,this.isNew||(t=`https://vue3-course-api.hexschool.io/api/je-api/admin/article/${e.id}`,o="put");const n=await this.$http[o](t,{data:this.tempArticle});this.isLoading=!1,this.getArticles(),this.pushMessageState(n)}catch(t){console.error("Error 找不到資料:",t)}finally{this.$refs.articleModal.hideModal()}},openDelModal(e){this.tempArticle={...e},this.$refs.delModal.showModal()},async delArticle(){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/je-api/admin/article/${this.tempArticle.id}`;try{const t=await A.Z["delete"](e);this.isLoading=!1,this.getArticles(),this.pushMessageState(t)}catch(t){console.error("Error 找不到資料",t)}finally{this.$refs.delModal.hideModal(),this.$refs.articleModal.hideModal()}}},created(){this.getArticles()},inject:["emitter","pushMessageState"]};const ot=(0,Ye.Z)(tt,[["render",k]]);var nt=ot}}]);
//# sourceMappingURL=627.6685d5b7.js.map